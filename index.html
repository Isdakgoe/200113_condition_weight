<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://unpkg.com/popper.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/ui/1.10.3/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js" type="text/javascript"></script>


</head>

<body>
    <!-- Shared Function -->
    <script>
        function rIDv(id) { return document.getElementById(id); } // ReturnIDValue
    </script>

    <!-- LogIn -->
    <div class="form-wrapper col-xs-6 col-xs-offset-2" style="font-size: 48px">
        <span  style="font-size: 62px">Sign In</span>
        <form>
            <div class="form-item">
                <label for="email"></label>
                <input type="email" name="email" required="required" placeholder="Email Address">
            </div>
            <div class="form-item">
                <label for="password"></label>
                <input type="password" name="password" required="required" placeholder="Password">
            </div>
            <div class="button-panel">
                <input type="submit" class="btn btn-primary btn-lg" title="Sign In" value="Sign In"/>
            </div>
            <br>
        </form>
        <div class="form-footer">
            <p><a href="#">Create an account</a></p>
            <p><a href="#">Forgot password?</a></p>
        </div>
    </div>

    <!-- get current time-->
    <script>
        function return2digitValue(value) {
            var value_string = String(value);
            if (value_string.length == 1) { return "0" + value_string; }
            else { return value_string; }
        }

        function getCurrentTime() {
            var now = new Date();
            var year = parseInt(String(now.getFullYear()).slice(2));
            var month = return2digitValue(now.getMonth()+1); //１を足すこと
            var day = return2digitValue(now.getDate());
            var hour = return2digitValue(now.getHours());
            var min = return2digitValue(now.getMinutes());
            // var sec = now.getSeconds();
            // var time = String(hour) + String(min);
            return {year, month, day, hour, min} ;
        }
    </script>

    <!-- Input own weight-->
    <hr>
    <div class="col-xs-6 col-xs-offset-4" style="font-size: 48px">
        <span  style="font-size: 62px">Input body-weight</span>

        <p style="font-size: 48px">
            <span id="span_currentTime"></span>
            <script>
                let {year, month, day, hour, min} = getCurrentTime();
                rIDv("span_currentTime").innerHTML = "【現在】" +year + "年 " + month + "月 " + day + "日 " + hour + "時 " + min + "分 ";
            </script>
        </p>
        <p style="font-size: 48px">
            &ensp;&ensp;<span> 体重 </span>
            <input type="text" value="" placeholder="00.00" id="weight_temp" size="2" name="weight_temp" style="text-align: right;">
            <span>kg</span>
            &ensp;<button id="btn_weight" class="btn btn-danger btn-lg">追加</button>
        </p>
    </div>

    <hr>

    <!-- Make Graph -->
    <div class="col-xs-10 col-xs-offset-1" style="font-size: 36px">
        <canvas id="graph-area" height="300" width="400" style="font-size: 36px">
            ※表示にはcanvas要素を解釈可能なブラウザが必要です。
        </canvas>
    </div>

    <!-- Result Table -->
    <hr>
    <div class="col-xs-9 col-xs-offset-2">
        <table id="table_result" class="table table-hover table-bordered table-striped fixheader" style="text-align: center; font-size: 36px">
            <thead>
                <tr>
                    <td>No</td>
                    <td>名前</td>
                    <td>年</td>
                    <td>月</td>
                    <td>日</td>
                    <td>時</td>
                    <td>分</td>
                    <td>体重</td>
                    <td>(消)</td>
                </tr>
            </thead>

        </table>
    </div>

    <!-- Get Table SentData -->
    <script>
    var player_No = 1;
    var player_Name = "松井";  var weight;
    var table = rIDv("table_result");

    ////////// Main //////////
    rIDv("btn_weight").onclick = function(){ addDataToTable(); window.myLine = new Chart(ctx).Line(getTableData()); };

    // Created Valuable
    var btn_delete = '<input type="button" value="D" onclick="deleteRow(this)" />';
    function deleteRow(obj) { tr = obj.parentNode.parentNode;
                              tr.parentNode.deleteRow(tr.sectionRowIndex);
                              window.myLine = new Chart(ctx).Line(getTableData());
                              }

    function inputValueToCell(Row, CellNo, Value) { Row.insertCell(CellNo).innerHTML = Value; }
    function addDataToTable() {
        let {year, month, day, hour, min} = getCurrentTime();
        weight = parseFloat(rIDv("weight_temp").value);
        let row_new = table.insertRow(-1);
        let array_result = [player_No, player_Name, year, month, day, hour, min, weight, btn_delete];
        for( var i=0; i<array_result.length; i++ ){ inputValueToCell(row_new, -1, array_result[i]); }
    }

    </script>

    <!-- Make Graph -->
    <script type="text/javascript">
    // Setting: Table
    var table_result = document.getElementById("table_result");

    // Setting: Canvas
    var ctx = document.getElementById("graph-area").getContext("2d");
    var rgba_gray = "rgba(92,220,92,0.2)";
    var rgba_green = "rgba(92,220,92,1)";

    function getTableData(){
        var num_row = table_result.rows.length;
        var num_col = table_result.rows[0].cells.length;  //全行を取得

        let data_x = []; let data_y = [];
        let past_x; let count = 1;
        for( var i=1; i<num_row; i++ ){
            let r_t = table_result.rows[i]; // r_t = row_temp

            // let x_temp_array = [];
            // let dateUnit_array = ["年", "月", "日",];
            // for( var j=0; j<dateUnit_array.length; j++ ){ x_temp_array.push(r_t.cells[j+2].innerHTML + dateUnit_array[j]); }
            // let x_temp = x_temp_array.join('');

            let year_month = r_t.cells[3].innerHTML + "/" + r_t.cells[4].innerHTML;
            let x_temp;
            if (year_month == past_x) { count++; x_temp = year_month + "(" + count + ")"; }
            else { count = 1; x_temp = year_month; }
            past_x = year_month;

            let y_temp = parseFloat(r_t.cells[7].innerHTML);
            data_x.push(x_temp); data_y.push(y_temp);
        }

        console.log("END: ", data_x, data_y);

        var lineChartData = {
            labels : data_x,
            datasets : [ {
                label: "緑データ",
                fillColor : rgba_gray, // 線から下端までを塗りつぶす色
                strokeColor : rgba_green, // 折れ線の色
                pointColor : rgba_green,  // ドットの塗りつぶし色

                pointStrokeColor : "white",        // ドットの枠線色
                pointHighlightFill : "yellow",     // マウスが載った際のドットの塗りつぶし色
                pointHighlightStroke : "red",    // マウスが載った際のドットの枠線色
                data : data_y      // 各点の値
            }]


        }

        return lineChartData;
    }




</script>

    <!-- OnLoadFunction -->
    <script>
        window.onload = function(){
            window.myLine = new Chart(ctx).Line(getTableData());
        }
    </script>

    <!-- 備考 -->
    <select name="example">
        <option value="サンプル1">サンプル1</option>
        <option value="サンプル2">サンプル2</option>
        <option value="サンプル3">サンプル3</option>
    </select>
</body>
</html>


